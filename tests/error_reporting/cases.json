[
  {
    "name": "undefined_variable",
    "source": "undefined_variable.orus",
    "description": "Accessing an undeclared variable should produce a helpful undefined-variable diagnostic.",
    "expected_exit": 65,
    "expected_diagnostic_count": 3,
    "expected_diagnostics": [
      {
        "title": "Can't find this variable",
        "message_contains": "Undefined variable 'missing_value'. Variables must be declared before use.",
        "help_contains": "Make sure you've declared the variable before using it",
        "note_contains": "Variables must be declared before they can be used in Orus.",
        "count": 3
      }
    ],
    "expected": [
      "-- SYNTAX ERROR: Can't find this variable",
      "Undefined variable 'missing_value'. Variables must be declared before use.",
      "help: Make sure you've declared the variable before using it, or check the spelling.",
      "note: Variables must be declared before they can be used in Orus.",
      "Compilation failed for \"tests/error_reporting/undefined_variable.orus\"."
    ]
  },
  {
    "name": "break_outside_loop",
    "source": "break_outside_loop.orus",
    "description": "Using 'break' outside of a loop should report a control-flow diagnostic.",
    "expected_exit": 65,
    "expected_diagnostic_count": 1,
    "expected_diagnostics": [
      {
        "title": "Something went wrong",
        "message_contains": "'break' can only be used inside a loop"
      }
    ],
    "expected": [
      "'break' can only be used inside a loop",
      "Compilation failed for \"tests/error_reporting/break_outside_loop.orus\"."
    ]
  },
  {
    "name": "continue_outside_loop",
    "source": "continue_outside_loop.orus",
    "description": "Using 'continue' outside of a loop should report a control-flow diagnostic.",
    "expected_exit": 65,
    "expected_diagnostic_count": 1,
    "expected_diagnostics": [
      {
        "title": "Something went wrong",
        "message_contains": "'continue' can only be used inside a loop"
      }
    ],
    "expected": [
      "'continue' can only be used inside a loop",
      "Compilation failed for \"tests/error_reporting/continue_outside_loop.orus\"."
    ]
  },
  {
    "name": "loop_control_valid",
    "source": "loop_control_valid.orus",
    "description": "Legal break/continue usage should compile without diagnostics.",
    "expected_exit": 0,
    "expected_diagnostic_count": 0,
    "expected": [
      "loop control success",
      "break at 4",
      "loop control done"
    ]
  },
  {
    "name": "immutable_assignment",
    "source": "immutable_assignment.orus",
    "description": "Reassigning an immutable binding should ask for the 'mut' keyword.",
    "expected_exit": 65,
    "expected_diagnostic_count": 1,
    "expected_diagnostics": [
      {
        "title": "This variable needs to be mutable",
        "message_contains": "Cannot assign to immutable variable 'value'. Add 'mut' when declaring it.",
        "help_contains": "Add 'mut' before the variable name when declaring it",
        "note_contains": "Variables are immutable by default"
      }
    ],
    "expected": [
      "-- SYNTAX ERROR: This variable needs to be mutable",
      "Cannot assign to immutable variable 'value'. Add 'mut' when declaring it.",
      "help: Add 'mut' before the variable name when declaring it: 'mut variable_name = value'",
      "note: Variables are immutable by default in Orus for safety and predictability.",
      "Compilation failed for \"tests/error_reporting/immutable_assignment.orus\"."
    ]
  },
  {
    "name": "variable_redefinition",
    "source": "variable_redefinition.orus",
    "description": "Declaring the same variable twice in one scope should report a redefinition error.",
    "expected_exit": 65,
    "expected_diagnostic_count": 1,
    "expected_diagnostics": [
      {
        "title": "This variable name is already taken",
        "message_contains": "already defined on line",
        "help_contains": "Choose a different name",
        "note_contains": "Each variable can only be declared once"
      }
    ],
    "expected": [
      "-- SYNTAX ERROR: This variable name is already taken",
      "Variable 'value' is already defined on line 2",
      "help: Choose a different name for this variable, or use assignment to change the existing one.",
      "note: Each variable can only be declared once in the same scope.",
      "Compilation failed for \"tests/error_reporting/variable_redefinition.orus\"."
    ]
  },
  {
    "name": "variable_scope_violation",
    "source": "variable_scope_violation.orus",
    "description": "Referencing a block-local variable outside of its scope should surface an undefined-variable diagnostic.",
    "expected_exit": 65,
    "expected_diagnostic_count": 1,
    "expected_diagnostics": [
      {
        "title": "Can't find this variable",
        "message_contains": "Undefined variable 'temp'",
        "help_contains": "Make sure you've declared the variable before using it"
      }
    ],
    "expected": [
      "-- SYNTAX ERROR: Can't find this variable",
      "Undefined variable 'temp'. Variables must be declared before use.",
      "help: Make sure you've declared the variable before using it, or check the spelling.",
      "note: Variables must be declared before they can be used in Orus.",
      "Compilation failed for \"tests/error_reporting/variable_scope_violation.orus\"."
    ]
  },
  {
    "name": "function_argument_mismatch",
    "source": "function_argument_mismatch.orus",
    "description": "Calling a function with the wrong number of arguments should emit a dedicated error.",
    "expected_exit": 65,
    "expected_diagnostic_count": 3,
    "expected_diagnostics": [
      {
        "category": "TYPE MISMATCH",
        "title": "Function call argument mismatch",
        "message_contains": "Not enough arguments for function call",
        "help_contains": "Add the missing arguments or remove the extras",
        "note_contains": "Orus checks function signatures strictly",
        "count": 3
      }
    ],
    "expected": [
      "-- TYPE MISMATCH: Function call argument mismatch",
      "Not enough arguments for function call: expected 2 arguments but found 1.",
      "help: Add the missing arguments or remove the extras so the call matches the function definition.",
      "note: Orus checks function signatures strictly so calls must use the exact number of parameters.",
      "Compilation failed for \"tests/error_reporting/function_argument_mismatch.orus\"."
    ]
  },
  {
    "name": "missing_if_colon",
    "source": "missing_if_colon.orus",
    "description": "If statements without a colon should surface a syntax error with context.",
    "expected_exit": 65,
    "expected_diagnostic_count": 1,
    "expected_diagnostics": [
      {
        "title": "Something went wrong",
        "message_contains": "Expected ':' after if statement"
      }
    ],
    "expected": [
      "-- SYNTAX ERROR: Something went wrong",
      "Expected ':' after if statement",
      "Compilation failed for \"tests/error_reporting/missing_if_colon.orus\"."
    ]
  },
  {
    "name": "missing_function_return_type",
    "source": "missing_function_return_type.orus",
    "description": "Functions that use '->' must provide an explicit return type before the block colon.",
    "expected_exit": 65,
    "expected_diagnostic_count": 1,
    "expected_diagnostics": [
      {
        "title": "This syntax isn't quite right",
        "message_contains": "Expected return type after '->' in function 'add'"
      }
    ],
    "expected": [
      "-- SYNTAX ERROR: This syntax isn't quite right",
      "Expected return type after '->' in function 'add', but found COLON",
      "help: Compare this syntax with a working example or check the docs to see what structure is expected here.",
      "note: Orus expected a different structure here. Re-read the surrounding code to find the mismatch.",
      "Compilation failed for \"tests/error_reporting/missing_function_return_type.orus\"."
    ]
  },
  {
    "name": "missing_closing_bracket",
    "source": "missing_closing_bracket.orus",
    "description": "Array literals without a closing ']' should report a clear syntax error with guidance.",
    "expected_exit": 65,
    "expected_diagnostic_count": 1,
    "expected_diagnostics": [
      {
        "title": "Missing closing bracket",
        "message_contains": "Expected ']' to close this array literal",
        "help_contains": "Add a closing ']' to match the opening '['",
        "note_contains": "Each '[' introduces"
      }
    ]
  },
  {
    "name": "unexpected_indent",
    "source": "unexpected_indent.orus",
    "description": "Indented statements without a surrounding block should clearly report the indentation error.",
    "expected_exit": 65,
    "expected_diagnostic_count": 1,
    "expected_diagnostics": [
      {
        "title": "Indentation looks off",
        "message_contains": "It looks like this line is indented, but there's no open block above it.",
        "help_contains": "If you meant to start a block",
        "note_contains": "Blocks in Orus begin"
      }
    ],
    "expected": [
      "-- SYNTAX ERROR: Indentation looks off",
      "It looks like this line is indented, but there's no open block above it.",
      "help: If you meant to start a block, add a ':' on the previous line or remove this extra indentation.",
      "note: Blocks in Orus begin after lines ending with ':' and end when the indentation returns.",
      "Compilation failed for \"tests/error_reporting/unexpected_indent.orus\"."
    ]
  },
  {
    "name": "closure_invalid_upvalue",
    "source": "closure_invalid_upvalue.orus",
    "description": "Mutating a captured immutable variable inside a closure is now caught at compile time.",
    "expected_exit": 65,
    "expected_diagnostic_count": 1,
    "expected_diagnostics": [
      {
        "title": "This variable needs to be mutable",
        "message_contains": "Cannot assign to immutable variable",
        "help_contains": "Add 'mut' before the variable name",
        "note_contains": "Variables are immutable by default"
      }
    ],
    "expected": [
      "-- SYNTAX ERROR: This variable needs to be mutable",
      "Cannot assign to immutable variable 'value'. Add 'mut' when declaring it.",
      "help: Add 'mut' before the variable name when declaring it: 'mut variable_name = value'",
      "note: Variables are immutable by default in Orus for safety and predictability.",
      "Compilation failed for \"tests/error_reporting/closure_invalid_upvalue.orus\"."
    ]
  },
  {
    "name": "runtime_division_by_zero_location",
    "source": "runtime_division_by_zero.orus",
    "description": "Runtime division by zero should report the correct source location.",
    "expected_exit": 70,
    "expected_diagnostic_count": 1,
    "expected_diagnostics": [
      {
        "category": "RUNTIME PANIC",
        "message_contains": "Division by zero",
        "location_contains": "runtime_division_by_zero.orus:4:13"
      }
    ],
    "expected": [
      "tests/error_reporting/runtime_division_by_zero.orus:4:13",
      "Division by zero"
    ]
  }
]
