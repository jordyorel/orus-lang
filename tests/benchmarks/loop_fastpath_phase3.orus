// Phase 3 loop microbenchmark focusing on zero-allocation typed iterators

TRIALS: i32 = 5
ITERATIONS: i32 = 1_000_000
ARRAY_LENGTH: i32 = 128
REPEATS: i32 = 1024

mut seed_values = []
mut fill_index: i32 = 0
while fill_index < ARRAY_LENGTH:
    push(seed_values, fill_index)
    fill_index = fill_index + 1

mut checksum: i64 = 0
mut trial: i32 = 0

while trial < TRIALS:
    start: f64 = time_stamp()

    mut typed_sum: i64 = 0
    for idx in ITERATIONS:
        typed_sum = typed_sum + idx

    mut repeat: i32 = 0
    mut array_sum: i64 = 0
    while repeat < REPEATS:
        for value in seed_values:
            array_sum = array_sum + value
        repeat = repeat + 1

    elapsed: f64 = time_stamp() - start
    print("elapsed:", elapsed)

    checksum = checksum + typed_sum + array_sum
    trial = trial + 1

print("checksum:", checksum)
print("trials:", TRIALS)
print("iterations:", ITERATIONS)
