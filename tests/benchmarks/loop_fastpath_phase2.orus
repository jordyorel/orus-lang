// Phase 2 loop microbenchmark focusing on typed increment fast paths

TRIALS: i32 = 5
ITERATIONS: i32 = 3_000_000

mut checksum: i64 = 0
mut trial: i32 = 0
expected_sum: i64 = ((ITERATIONS as i64) * ((ITERATIONS - 1) as i64)) / (2 as i64)

while trial < TRIALS:
    start: f64 = time_stamp()
    mut i: i32 = 0
    mut sum: i64 = 0

    while i < ITERATIONS:
        sum = sum + (i as i64)
        i = i + 1

    elapsed: f64 = time_stamp() - start
    print("elapsed:", elapsed)
    if assert_eq("loop_fastpath_phase2 sum", sum, expected_sum):
        print("ok", "trial sum", sum)

    checksum = checksum + sum
    trial = trial + 1

print("checksum:", checksum)
print("trials:", TRIALS)
print("iterations:", ITERATIONS)
if assert_eq("loop_fastpath_phase2 checksum", checksum, expected_sum * (TRIALS as i64)):
    print("ok", "total checksum", checksum)
